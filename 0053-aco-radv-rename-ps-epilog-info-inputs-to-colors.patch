From 77d596666196e8834a148c821db917648280f379 Mon Sep 17 00:00:00 2001
From: Qiang Yu <yuq825@gmail.com>
Date: Mon, 14 Aug 2023 17:05:32 +0800
Subject: [PATCH 053/834] aco,radv: rename ps epilog info inputs to colors

Will add other mrtz args for radeonsi.

Reviewed-by: Rhys Perry <pendingchaos02@gmail.com>
Signed-off-by: Qiang Yu <yuq825@gmail.com>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/24973>
---
 src/amd/compiler/aco_instruction_selection.cpp | 10 +++++-----
 src/amd/compiler/aco_shader_info.h             |  2 +-
 src/amd/vulkan/radv_aco_shader_info.h          |  2 +-
 3 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/src/amd/compiler/aco_instruction_selection.cpp b/src/amd/compiler/aco_instruction_selection.cpp
index 9460c095a24..4273bf2cfb7 100644
--- a/src/amd/compiler/aco_instruction_selection.cpp
+++ b/src/amd/compiler/aco_instruction_selection.cpp
@@ -12733,10 +12733,10 @@ select_ps_epilog(Program* program, void* pinfo, ac_shader_config* config,
    Builder bld(ctx.program, ctx.block);
 
    /* Export all color render targets */
-   struct aco_export_mrt mrts[8];
+   struct aco_export_mrt mrts[MAX_DRAW_BUFFERS];
    uint8_t exported_mrts = 0;
 
-   for (unsigned i = 0; i < 8; i++) {
+   for (unsigned i = 0; i < MAX_DRAW_BUFFERS; i++) {
       unsigned col_format = (einfo->spi_shader_col_format >> (i * 4)) & 0xf;
 
       if (col_format == V_028714_SPI_SHADER_ZERO)
@@ -12751,10 +12751,10 @@ select_ps_epilog(Program* program, void* pinfo, ac_shader_config* config,
       out.is_int10 = (einfo->color_is_int10 >> i) & 1;
       out.enable_mrt_output_nan_fixup = (options->enable_mrt_output_nan_fixup >> i) & 1;
 
-      Temp inputs = get_arg(&ctx, einfo->inputs[i]);
-      emit_split_vector(&ctx, inputs, 4);
+      Temp colors = get_arg(&ctx, einfo->colors[i]);
+      emit_split_vector(&ctx, colors, 4);
       for (unsigned c = 0; c < 4; ++c) {
-         out.values[c] = Operand(emit_extract_vector(&ctx, inputs, c, v1));
+         out.values[c] = Operand(emit_extract_vector(&ctx, colors, c, v1));
       }
 
       if (export_fs_mrt_color(&ctx, &out, &mrts[i])) {
diff --git a/src/amd/compiler/aco_shader_info.h b/src/amd/compiler/aco_shader_info.h
index 5fecb0fa0fd..281c7182f7f 100644
--- a/src/amd/compiler/aco_shader_info.h
+++ b/src/amd/compiler/aco_shader_info.h
@@ -65,7 +65,7 @@ struct aco_vs_prolog_info {
 };
 
 struct aco_ps_epilog_info {
-   struct ac_arg inputs[8];
+   struct ac_arg colors[MAX_DRAW_BUFFERS];
 
    uint32_t spi_shader_col_format;
 
diff --git a/src/amd/vulkan/radv_aco_shader_info.h b/src/amd/vulkan/radv_aco_shader_info.h
index 04035720a5f..4ae15e2c5f8 100644
--- a/src/amd/vulkan/radv_aco_shader_info.h
+++ b/src/amd/vulkan/radv_aco_shader_info.h
@@ -117,7 +117,7 @@ radv_aco_convert_ps_epilog_key(struct aco_ps_epilog_info *aco_info, const struct
    ASSIGN_FIELD(color_is_int10);
    ASSIGN_FIELD(mrt0_is_dual_src);
 
-   memcpy(aco_info->inputs, radv_args->ps_epilog_inputs, sizeof(aco_info->inputs));
+   memcpy(aco_info->colors, radv_args->ps_epilog_inputs, sizeof(aco_info->colors));
 }
 
 static inline void
-- 
2.42.0

