From 6bfa8850ab30036dc993faf59472d49f385749a7 Mon Sep 17 00:00:00 2001
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
Date: Mon, 9 Oct 2023 13:37:18 +0300
Subject: [PATCH 014/834] anv: implement INTEL_DEBUG=reemit
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
Reviewed-by: Tapani PÃ¤lli <tapani.palli@intel.com>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/25618>
---
 src/intel/vulkan/genX_gfx_state.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/intel/vulkan/genX_gfx_state.c b/src/intel/vulkan/genX_gfx_state.c
index 8041bd48eb6..9367be0671a 100644
--- a/src/intel/vulkan/genX_gfx_state.c
+++ b/src/intel/vulkan/genX_gfx_state.c
@@ -1143,6 +1143,12 @@ genX(cmd_buffer_flush_gfx_hw_state)(struct anv_cmd_buffer *cmd_buffer)
       &cmd_buffer->vk.dynamic_graphics_state;
    struct anv_gfx_dynamic_state *hw_state = &gfx->dyn_state;
 
+   if (INTEL_DEBUG(DEBUG_REEMIT)) {
+      BITSET_OR(cmd_buffer->state.gfx.dyn_state.dirty,
+                cmd_buffer->state.gfx.dyn_state.dirty,
+                device->gfx_dirty_state);
+   }
+
    /* Since Wa_16011773973 will disable 3DSTATE_STREAMOUT, we need to reemit
     * it after.
     */
-- 
2.42.0

