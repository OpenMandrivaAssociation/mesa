From fe05e6610b2f43d885aa0c4df7d302676015e398 Mon Sep 17 00:00:00 2001
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
Date: Thu, 5 Oct 2023 22:28:26 +0300
Subject: [PATCH 204/834] anv: fixup spirv cap for ImageReadWithoutFormat on
 Gfx12.5
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
Fixes: 2e2491b76c ("anv: enable shaderStorageImageReadWithoutFormat on Gfx12.5+")
Reviewed-by: Tapani PÃ¤lli <tapani.palli@intel.com>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/25573>
---
 src/intel/vulkan/anv_pipeline.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/intel/vulkan/anv_pipeline.c b/src/intel/vulkan/anv_pipeline.c
index bb2607feb5e..52f97aec312 100644
--- a/src/intel/vulkan/anv_pipeline.c
+++ b/src/intel/vulkan/anv_pipeline.c
@@ -163,7 +163,10 @@ anv_shader_stage_to_nir(struct anv_device *device,
           * read/write without format is per format, so just report true. It's
           * up to the application to check.
           */
-         .image_read_without_format = instance->vk.app_info.api_version >= VK_API_VERSION_1_3 || device->vk.enabled_extensions.KHR_format_feature_flags2,
+         .image_read_without_format =
+            pdevice->info.verx10 >= 125 ||
+            instance->vk.app_info.api_version >= VK_API_VERSION_1_3 ||
+            device->vk.enabled_extensions.KHR_format_feature_flags2,
          .image_write_without_format = true,
          .int8 = true,
          .int16 = true,
-- 
2.42.0

