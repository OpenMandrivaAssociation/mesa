From c924f6908f93897ea8f621473a15ba968009f0e3 Mon Sep 17 00:00:00 2001
From: Faith Ekstrand <faith.ekstrand@collabora.com>
Date: Wed, 18 Oct 2023 05:56:15 -0500
Subject: [PATCH 534/834] nvk: Advertise VK_EXT_primitive_topology_list_restart

Closes: https://gitlab.freedesktop.org/mesa/mesa/-/issues/9645
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/25786>
---
 docs/features.txt                        | 2 +-
 src/nouveau/vulkan/nvk_physical_device.c | 5 +++++
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/docs/features.txt b/docs/features.txt
index edac939b6c0..40f4caba5da 100644
--- a/docs/features.txt
+++ b/docs/features.txt
@@ -592,7 +592,7 @@ Khronos extensions that are not part of any Vulkan version:
   VK_EXT_pipeline_library_group_handles                 DONE (anv, radv)
   VK_EXT_pipeline_robustness                            DONE (anv, radv, v3dv)
   VK_EXT_post_depth_coverage                            DONE (anv/gfx10+, lvp, radv/gfx10+)
-  VK_EXT_primitive_topology_list_restart                DONE (anv, hasvk, lvp, radv, tu, v3dv, vn)
+  VK_EXT_primitive_topology_list_restart                DONE (anv, hasvk, lvp, nvk, radv, tu, v3dv, vn)
   VK_EXT_primitives_generated_query                     DONE (anv, hasvk, lvp, radv, tu, vn)
   VK_EXT_provoking_vertex                               DONE (anv, hasvk, lvp, nvk, radv, tu, v3dv, vn)
   VK_EXT_queue_family_foreign                           DONE (anv, hasvk, radv, tu, vn)
diff --git a/src/nouveau/vulkan/nvk_physical_device.c b/src/nouveau/vulkan/nvk_physical_device.c
index 355f2a5ae56..ff72046fab2 100644
--- a/src/nouveau/vulkan/nvk_physical_device.c
+++ b/src/nouveau/vulkan/nvk_physical_device.c
@@ -123,6 +123,7 @@ nvk_get_device_extensions(const struct nv_device_info *info,
       .EXT_non_seamless_cube_map = true,
       .EXT_pci_bus_info = info->type == NV_DEVICE_TYPE_DIS,
       .EXT_physical_device_drm = true,
+      .EXT_primitive_topology_list_restart = true,
       .EXT_private_data = true,
       .EXT_provoking_vertex = true,
       .EXT_robustness2 = true,
@@ -352,6 +353,10 @@ nvk_get_device_features(const struct nv_device_info *info,
       /* VK_EXT_non_seamless_cube_map */
       .nonSeamlessCubeMap = true,
 
+      /* VK_EXT_primitive_topology_list_restart */
+      .primitiveTopologyListRestart = true,
+      .primitiveTopologyPatchListRestart = true,
+
       /* VK_EXT_provoking_vertex */
       .provokingVertexLast = true,
       .transformFeedbackPreservesProvokingVertex = true,
-- 
2.42.0

